# ä¿®å¤ç›¸å†Œé€‰æ‹©é—ªé€€é—®é¢˜

## âŒ é—®é¢˜æè¿°

ç‚¹å‡»"ç›¸å†Œ"æŒ‰é’®æ—¶åº”ç”¨é—ªé€€ã€‚

## ğŸ” é—®é¢˜åŸå› 

1. **`PickVisualMedia` API ä¸å…¼å®¹**
   - `PickVisualMedia` åœ¨æŸäº› Android ç‰ˆæœ¬æˆ–è®¾å¤‡ä¸Šå¯èƒ½ä¸ç¨³å®š
   - `launch(null)` å¯èƒ½å¯¼è‡´å´©æºƒ

2. **ç›¸æœºé¢„è§ˆç»‘å®šé—®é¢˜**
   - `PreviewView` å’Œ `Preview` use case çš„ç»‘å®šå¯èƒ½ä¸æ­£ç¡®

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ”¹ç”¨ `GetContent` æ›¿ä»£ `PickVisualMedia`

**åŸå› **ï¼š
- `GetContent` æ˜¯æ›´ç¨³å®šå’Œå…¼å®¹çš„ API
- æ”¯æŒæ‰€æœ‰ Android ç‰ˆæœ¬
- ä¸éœ€è¦å¤æ‚çš„å‚æ•°é…ç½®

**ä¿®æ”¹**ï¼š
```kotlin
// ä¿®å¤å‰
val imagePicker = rememberLauncherForActivityResult(
    contract = ActivityResultContracts.PickVisualMedia()
) { uri ->
    uri?.let { onComplete(it) }
}
imagePicker.launch(null)

// ä¿®å¤å
val imagePicker = rememberLauncherForActivityResult(
    contract = ActivityResultContracts.GetContent()
) { uri: Uri? ->
    uri?.let { onComplete(it) }
}
imagePicker.launch("image/*")
```

### 2. ä¿®å¤ç›¸æœºé¢„è§ˆç»‘å®š

**ä¿®æ”¹**ï¼š
- å°† `PreviewView` çš„å¼•ç”¨ä¿å­˜åˆ°çŠ¶æ€ä¸­
- åœ¨ `LaunchedEffect` ä¸­æ­£ç¡®è®¾ç½® `surfaceProvider`

---

## ğŸ“‹ ä¿®æ”¹å†…å®¹

### CameraScreen.kt

1. **å›¾ç‰‡é€‰æ‹©å™¨**
   - ä» `PickVisualMedia` æ”¹ä¸º `GetContent`
   - ä½¿ç”¨ `"image/*"` MIME ç±»å‹é™åˆ¶åªé€‰æ‹©å›¾ç‰‡

2. **ç›¸æœºé¢„è§ˆ**
   - ä¿®å¤ `PreviewView` å’Œ `Preview` use case çš„ç»‘å®š
   - ç¡®ä¿é¢„è§ˆæ­£ç¡®æ˜¾ç¤º

---

## âœ… éªŒè¯ä¿®å¤

### æµ‹è¯•æ­¥éª¤

1. **é‡æ–°ç¼–è¯‘å¹¶å®‰è£…åº”ç”¨**
   ```bash
   cd diabeat-android
   ./gradlew assembleDebug
   adb install -r app/build/outputs/apk/debug/app-debug.apk
   ```

2. **æµ‹è¯•ç›¸å†Œé€‰æ‹©**
   - æ‰“å¼€åº”ç”¨
   - ç‚¹å‡»"ç›¸å†Œ"æŒ‰é’®
   - åº”è¯¥èƒ½æ­£å¸¸æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨ï¼Œä¸å†é—ªé€€

3. **æµ‹è¯•ç›¸æœºé¢„è§ˆ**
   - ç¡®è®¤ç›¸æœºé¢„è§ˆæ­£å¸¸æ˜¾ç¤º
   - ç¡®è®¤å¯ä»¥æ­£å¸¸ä½¿ç”¨

---

## ğŸ” å¦‚æœä»ç„¶æœ‰é—®é¢˜

### æ£€æŸ¥æƒé™

ç¡®ä¿ AndroidManifest.xml ä¸­æœ‰å¿…è¦çš„æƒé™ï¼š

```xml
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.CAMERA" />
```

### æ£€æŸ¥ Android ç‰ˆæœ¬

`GetContent` åœ¨æ‰€æœ‰ Android ç‰ˆæœ¬ä¸Šéƒ½å¯ç”¨ï¼Œä½†å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•ï¼š

1. **æ·»åŠ å¼‚å¸¸å¤„ç†**
   ```kotlin
   Button(onClick = {
       try {
           imagePicker.launch("image/*")
       } catch (e: Exception) {
           e.printStackTrace()
           // æ˜¾ç¤ºé”™è¯¯æç¤º
       }
   })
   ```

2. **ä½¿ç”¨ `PickMultipleVisualMedia`ï¼ˆå¦‚æœéœ€è¦å¤šé€‰ï¼‰**
   ```kotlin
   val imagePicker = rememberLauncherForActivityResult(
       contract = ActivityResultContracts.PickMultipleVisualMedia()
   ) { uris ->
       uris.firstOrNull()?.let { onComplete(it) }
   }
   ```

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### GetContent vs PickVisualMedia

| ç‰¹æ€§ | GetContent | PickVisualMedia |
|------|-----------|----------------|
| å…¼å®¹æ€§ | æ‰€æœ‰ Android ç‰ˆæœ¬ | Android 13+ |
| ç¨³å®šæ€§ | é«˜ | ä¸­ç­‰ |
| åŠŸèƒ½ | åŸºç¡€æ–‡ä»¶é€‰æ‹© | æ›´ä¸°å¯Œçš„åª’ä½“é€‰æ‹© |
| æ¨èä½¿ç”¨ | âœ… æ˜¯ | ä»…åœ¨éœ€è¦æ–°ç‰¹æ€§æ—¶ |

---

**ä¿®å¤å®Œæˆ**ï¼šç›¸å†Œé€‰æ‹©åº”è¯¥ä¸å†é—ªé€€äº†ï¼âœ…

å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚

