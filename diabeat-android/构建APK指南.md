# æ„å»º APK å¹¶åœ¨æ¨¡æ‹Ÿå™¨è¿è¡ŒæŒ‡å—

## ğŸ“¦ æ„å»º APK

### æ–¹æ³• 1ï¼šä½¿ç”¨ Android Studioï¼ˆæ¨èï¼‰

1. **æ‰“å¼€é¡¹ç›®**
   - åœ¨ Android Studio ä¸­æ‰“å¼€ `diabeat-android` ç›®å½•

2. **åŒæ­¥ Gradle**
   - ç‚¹å‡» "Sync Project with Gradle Files" ğŸ”„
   - ç­‰å¾…åŒæ­¥å®Œæˆ

3. **æ„å»º APK**
   - èœå•ï¼š`Build` â†’ `Build Bundle(s) / APK(s)` â†’ `Build APK(s)`
   - æˆ–ä½¿ç”¨å¿«æ·é”®ï¼š`Ctrl+Shift+A` (Windows/Linux) æˆ– `Cmd+Shift+A` (Mac)ï¼Œè¾“å…¥ "Build APK"

4. **ç­‰å¾…æ„å»ºå®Œæˆ**
   - æ„å»ºå®Œæˆåä¼šæ˜¾ç¤ºé€šçŸ¥
   - ç‚¹å‡» "locate" æŸ¥çœ‹ APK æ–‡ä»¶ä½ç½®

5. **APK ä½ç½®**
   - `app/build/outputs/apk/debug/app-debug.apk`

### æ–¹æ³• 2ï¼šä½¿ç”¨å‘½ä»¤è¡Œ

```bash
cd diabeat-android

# å¦‚æœä½¿ç”¨ Gradle Wrapper
./gradlew assembleDebug

# å¦‚æœä½¿ç”¨ç³»ç»Ÿ Gradle
gradle assembleDebug
```

**APK ä½ç½®**ï¼š`app/build/outputs/apk/debug/app-debug.apk`

---

## ğŸ“± åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ

### æ­¥éª¤ 1ï¼šå¯åŠ¨ Android æ¨¡æ‹Ÿå™¨

#### ä½¿ç”¨ Android Studio

1. **æ‰“å¼€ AVD Manager**
   - ç‚¹å‡»å·¥å…·æ çš„ "Device Manager" å›¾æ ‡
   - æˆ–èœå•ï¼š`Tools` â†’ `Device Manager`

2. **åˆ›å»ºæˆ–é€‰æ‹©æ¨¡æ‹Ÿå™¨**
   - å¦‚æœæ²¡æœ‰æ¨¡æ‹Ÿå™¨ï¼Œç‚¹å‡» "Create Device"
   - é€‰æ‹©ä¸€ä¸ªè®¾å¤‡ï¼ˆæ¨èï¼šPixel 5 æˆ– Pixel 6ï¼‰
   - é€‰æ‹©ä¸€ä¸ªç³»ç»Ÿé•œåƒï¼ˆæ¨èï¼šAPI 33 æˆ–æ›´é«˜ï¼‰
   - ç‚¹å‡» "Finish"

3. **å¯åŠ¨æ¨¡æ‹Ÿå™¨**
   - ç‚¹å‡»æ¨¡æ‹Ÿå™¨å³ä¾§çš„ "Play" æŒ‰é’® â–¶ï¸
   - ç­‰å¾…æ¨¡æ‹Ÿå™¨å¯åŠ¨å®Œæˆ

#### ä½¿ç”¨å‘½ä»¤è¡Œ

```bash
# åˆ—å‡ºå¯ç”¨çš„æ¨¡æ‹Ÿå™¨
emulator -list-avds

# å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ¨¡æ‹Ÿå™¨åç§°ï¼‰
emulator -avd Pixel_5_API_33
```

### æ­¥éª¤ 2ï¼šå®‰è£… APK

#### æ–¹æ³• 1ï¼šä½¿ç”¨ Android Studioï¼ˆæœ€ç®€å•ï¼‰

1. **è¿è¡Œåº”ç”¨**
   - åœ¨ Android Studio ä¸­é€‰æ‹©æ¨¡æ‹Ÿå™¨
   - ç‚¹å‡» "Run" æŒ‰é’® â–¶ï¸
   - æˆ–ä½¿ç”¨å¿«æ·é”®ï¼š`Shift+F10` (Windows/Linux) æˆ– `Ctrl+R` (Mac)

2. **è‡ªåŠ¨å®‰è£…å’Œå¯åŠ¨**
   - Android Studio ä¼šè‡ªåŠ¨å®‰è£… APK å¹¶å¯åŠ¨åº”ç”¨

#### æ–¹æ³• 2ï¼šä½¿ç”¨ adb å‘½ä»¤

```bash
# æ£€æŸ¥è®¾å¤‡è¿æ¥
adb devices

# å®‰è£… APK
adb install app/build/outputs/apk/debug/app-debug.apk

# å¯åŠ¨åº”ç”¨
adb shell am start -n com.diabeat/.ui.MainActivity
```

### æ­¥éª¤ 3ï¼šå¯åŠ¨æœåŠ¡å™¨ï¼ˆå¿…éœ€ï¼‰

**é‡è¦**ï¼šåº”ç”¨éœ€è¦è¿æ¥åˆ°æœåŠ¡å™¨æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚

```bash
cd diabeat-server

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**æ³¨æ„**ï¼š
- æœåŠ¡å™¨å¿…é¡»ç›‘å¬ `0.0.0.0`ï¼Œä¸èƒ½åªç›‘å¬ `127.0.0.1`
- æ¨¡æ‹Ÿå™¨ä½¿ç”¨ `10.0.2.2` è®¿é—®æœ¬åœ°æœåŠ¡å™¨
- å·²é…ç½®ï¼š`config.xml` ä¸­çš„ `api_base_url` ä¸º `http://10.0.2.2:8000`

---

## âœ… éªŒè¯è¿è¡Œ

### 1. æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯åŠ¨

- æ¨¡æ‹Ÿå™¨ä¸Šåº”è¯¥èƒ½çœ‹åˆ°åº”ç”¨å›¾æ ‡
- ç‚¹å‡»å›¾æ ‡æˆ–ä» Android Studio è¿è¡Œ

### 2. æ£€æŸ¥åŠŸèƒ½

1. **ç›¸æœºåŠŸèƒ½**
   - åº”ç”¨å¯åŠ¨ååº”è¯¥æ˜¾ç¤ºç›¸æœºç•Œé¢
   - ç‚¹å‡»æ‹ç…§æŒ‰é’®æµ‹è¯•

2. **ç½‘ç»œè¿æ¥**
   - å¦‚æœæœåŠ¡å™¨å·²å¯åŠ¨ï¼Œåº”è¯¥èƒ½æ­£å¸¸è°ƒç”¨ API
   - å¦‚æœæœåŠ¡å™¨æœªå¯åŠ¨ï¼Œä¼šæ˜¾ç¤ºç½‘ç»œé”™è¯¯

### 3. æŸ¥çœ‹æ—¥å¿—

åœ¨ Android Studio çš„ "Logcat" çª—å£ä¸­æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š

```
# è¿‡æ»¤æ—¥å¿—
tag:DiabEat
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ„å»ºå¤±è´¥

**é”™è¯¯**ï¼š`Could not find or load main class`

**è§£å†³**ï¼š
```bash
# åˆå§‹åŒ– Gradle Wrapper
cd diabeat-android
gradle wrapper
```

### é—®é¢˜ 2ï¼šæ¨¡æ‹Ÿå™¨æ— æ³•è¿æ¥æœåŠ¡å™¨

**æ£€æŸ¥**ï¼š
1. æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ï¼š`curl http://localhost:8000/health`
2. æœåŠ¡å™¨æ˜¯å¦ç›‘å¬ `0.0.0.0`ï¼šæ£€æŸ¥å¯åŠ¨å‘½ä»¤
3. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ï¼šæ£€æŸ¥é˜²ç«å¢™è®¾ç½®

**è§£å†³**ï¼š
```bash
# ç¡®ä¿æœåŠ¡å™¨ç›‘å¬æ‰€æœ‰æ¥å£
uvicorn app.main:app --reload --host 0.0.2.0 --port 8000
```

### é—®é¢˜ 3ï¼šAPK å®‰è£…å¤±è´¥

**é”™è¯¯**ï¼š`INSTALL_FAILED_INSUFFICIENT_STORAGE`

**è§£å†³**ï¼š
- æ¸…ç†æ¨¡æ‹Ÿå™¨å­˜å‚¨ç©ºé—´
- åˆ é™¤ä¸éœ€è¦çš„åº”ç”¨

**é”™è¯¯**ï¼š`INSTALL_FAILED_UPDATE_INCOMPATIBLE`

**è§£å†³**ï¼š
```bash
# å¸è½½æ—§ç‰ˆæœ¬
adb uninstall com.diabeat

# é‡æ–°å®‰è£…
adb install app/build/outputs/apk/debug/app-debug.apk
```

### é—®é¢˜ 4ï¼šç›¸æœºæƒé™è¢«æ‹’ç»

**è§£å†³**ï¼š
- åœ¨æ¨¡æ‹Ÿå™¨è®¾ç½®ä¸­æˆäºˆç›¸æœºæƒé™
- æˆ–åœ¨åº”ç”¨è¿è¡Œæ—¶ç‚¹å‡» "å…è®¸"

---

## ğŸ“‹ å®Œæ•´æµç¨‹æ£€æŸ¥æ¸…å•

### æ„å»º APK

- [ ] é¡¹ç›®å·²åŒæ­¥ Gradle
- [ ] å·²é…ç½® API åœ°å€ï¼ˆ`http://10.0.2.2:8000`ï¼‰
- [ ] å·²æ„å»º APKï¼ˆ`app-debug.apk`ï¼‰

### è¿è¡Œç¯å¢ƒ

- [ ] Android æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨
- [ ] æœåŠ¡å™¨å·²å¯åŠ¨ï¼ˆ`uvicorn app.main:app --reload --host 0.0.0.0 --port 8000`ï¼‰
- [ ] æœåŠ¡å™¨å¥åº·æ£€æŸ¥é€šè¿‡ï¼ˆ`http://localhost:8000/health`ï¼‰

### å®‰è£…å’Œè¿è¡Œ

- [ ] APK å·²å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨
- [ ] åº”ç”¨å·²å¯åŠ¨
- [ ] ç›¸æœºåŠŸèƒ½æ­£å¸¸
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤æ€»ç»“

```bash
# 1. æ„å»º APK
cd diabeat-android
./gradlew assembleDebug

# 2. å¯åŠ¨æœåŠ¡å™¨
cd ../diabeat-server
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 3. å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆåœ¨ Android Studio ä¸­ï¼‰

# 4. å®‰è£… APK
adb install app/build/outputs/apk/debug/app-debug.apk

# 5. å¯åŠ¨åº”ç”¨
adb shell am start -n com.diabeat/.ui.MainActivity
```

---

**æœ€åæ›´æ–°**ï¼š2025-11-06

