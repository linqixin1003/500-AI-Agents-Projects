# ä¿®å¤ Java å †å†…å­˜ä¸è¶³é”™è¯¯

## âŒ é”™è¯¯ä¿¡æ¯

```
Caused by: java.lang.OutOfMemoryError: Java heap space
```

**åŸå› **ï¼šGradle åœ¨åˆå¹¶ DEX æ–‡ä»¶æ—¶å†…å­˜ä¸è¶³ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. å¢åŠ  Gradle å †å†…å­˜

å·²åˆ›å»º `gradle.properties` æ–‡ä»¶ï¼Œé…ç½®äº†æ›´å¤§çš„å†…å­˜ï¼š

```properties
org.gradle.jvmargs=-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
```

**è¯´æ˜**ï¼š
- `-Xmx4096m`ï¼šæœ€å¤§å †å†…å­˜ 4GB
- `-XX:MaxMetaspaceSize=1024m`ï¼šå…ƒç©ºé—´æœ€å¤§ 1GB
- `-XX:+HeapDumpOnOutOfMemoryError`ï¼šå†…å­˜æº¢å‡ºæ—¶ç”Ÿæˆå †è½¬å‚¨

### 2. å¯ç”¨å¹¶è¡Œæ„å»º

```properties
org.gradle.parallel=true
org.gradle.caching=true
```

### 3. ä¼˜åŒ–æ‰“åŒ…é…ç½®

åœ¨ `app/build.gradle.kts` ä¸­æ·»åŠ äº†èµ„æºæ’é™¤é…ç½®ï¼Œå‡å°‘æ‰“åŒ…å¤§å°ã€‚

---

## ğŸ”§ ä¿®æ”¹å†…å®¹

### gradle.propertiesï¼ˆæ–°å»ºï¼‰

```properties
# å¢åŠ å †å†…å­˜åˆ° 4GB
org.gradle.jvmargs=-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8

# å¯ç”¨å¹¶è¡Œæ„å»º
org.gradle.parallel=true
org.gradle.caching=true

# AndroidX
android.useAndroidX=true
android.nonTransitiveRClass=true
```

### app/build.gradle.kts

æ·»åŠ äº†æ‰“åŒ…ä¼˜åŒ–é…ç½®ï¼š
```kotlin
packaging {
    resources {
        excludes += "/META-INF/{AL2.0,LGPL2.1}"
    }
}
```

---

## âœ… éªŒè¯ä¿®å¤

### æ–¹æ³• 1ï¼šæ¸…ç†å¹¶é‡æ–°æ„å»º

```bash
cd diabeat-android

# æ¸…ç†æ„å»ºç¼“å­˜
./gradlew clean

# é‡æ–°æ„å»º
./gradlew assembleDebug
```

### æ–¹æ³• 2ï¼šåœ¨ Android Studio ä¸­

1. **æ¸…ç†é¡¹ç›®**
   - èœå•ï¼š`Build` â†’ `Clean Project`

2. **ä½¿ç¼“å­˜å¤±æ•ˆå¹¶é‡å¯**
   - èœå•ï¼š`File` â†’ `Invalidate Caches...` â†’ `Invalidate and Restart`

3. **é‡æ–°æ„å»º**
   - èœå•ï¼š`Build` â†’ `Rebuild Project`

---

## ğŸ” å¦‚æœä»ç„¶å†…å­˜ä¸è¶³

### é€‰é¡¹ 1ï¼šè¿›ä¸€æ­¥å¢åŠ å†…å­˜

ç¼–è¾‘ `gradle.properties`ï¼š
```properties
org.gradle.jvmargs=-Xmx6144m -XX:MaxMetaspaceSize=2048m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
```

### é€‰é¡¹ 2ï¼šå‡å°‘ä¾èµ–

æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æˆ–ä¸éœ€è¦çš„ä¾èµ–ï¼Œå¯ä»¥ç§»é™¤ä¸€äº›ã€‚

### é€‰é¡¹ 3ï¼šå¯ç”¨ ProGuardï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

åœ¨ `buildTypes.release` ä¸­å¯ç”¨ä»£ç æ··æ·†ï¼Œå¯ä»¥å‡å°‘ APK å¤§å°ã€‚

---

## ğŸ“‹ å½“å‰é…ç½®

### gradle.properties

- âœ… å †å†…å­˜ï¼š4GB
- âœ… å…ƒç©ºé—´ï¼š1GB
- âœ… å¹¶è¡Œæ„å»ºï¼šå¯ç”¨
- âœ… æ„å»ºç¼“å­˜ï¼šå¯ç”¨

### app/build.gradle.kts

- âœ… æ‰“åŒ…ä¼˜åŒ–ï¼šå·²é…ç½®
- âœ… èµ„æºæ’é™¤ï¼šå·²é…ç½®

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **åŒæ­¥ Gradle**
   - åœ¨ Android Studio ä¸­ç‚¹å‡» "Sync Project with Gradle Files"

2. **æ¸…ç†é¡¹ç›®**
   - `Build` â†’ `Clean Project`

3. **é‡æ–°æ„å»º**
   - `Build` â†’ `Rebuild Project`

---

**ä¿®å¤å®Œæˆ**ï¼šç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸ç¼–è¯‘äº†ï¼âœ…

å¦‚æœä»ç„¶é‡åˆ°å†…å­˜é—®é¢˜ï¼Œå¯ä»¥è¿›ä¸€æ­¥å¢åŠ å†…å­˜é…ç½®ã€‚

