# .env é…ç½®æ–‡ä»¶è¯¦ç»†è¯´æ˜

## ğŸ“ å¦‚ä½•é…ç½®

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cd diabeat-server/config
cp .env.example .env
```

### ç¬¬äºŒæ­¥ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶

```bash
# ä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€
vim .env
# æˆ–
nano .env
# æˆ–
code .env
```

---

## ğŸ”§ å¿…éœ€é…ç½®é¡¹è¯´æ˜

### 1. DATABASE_URLï¼ˆæ•°æ®åº“è¿æ¥ï¼‰

**ä½œç”¨**ï¼šè¿æ¥ PostgreSQL æ•°æ®åº“

**é…ç½®å€¼**ï¼š
```env
DATABASE_URL=postgresql://diabeat:diabeat123@localhost:5432/diabeat
```

**è¯´æ˜**ï¼š
- å¦‚æœä½¿ç”¨ `docker-compose` å¯åŠ¨æ•°æ®åº“ï¼Œä½¿ç”¨ä¸Šé¢çš„å€¼å³å¯
- æ ¼å¼ï¼š`postgresql://ç”¨æˆ·å:å¯†ç @ä¸»æœº:ç«¯å£/æ•°æ®åº“å`
- é»˜è®¤å€¼ï¼ˆdocker-composeï¼‰ï¼š
  - ç”¨æˆ·åï¼š`diabeat`
  - å¯†ç ï¼š`diabeat123`
  - ä¸»æœºï¼š`localhost`
  - ç«¯å£ï¼š`5432`
  - æ•°æ®åº“åï¼š`diabeat`

**å¦‚æœä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“**ï¼š
```env
DATABASE_URL=postgresql://your_user:your_password@your_host:5432/your_database
```

---

### 2. SECRET_KEYï¼ˆJWT å¯†é’¥ï¼‰

**ä½œç”¨**ï¼šç”¨äºç”Ÿæˆå’ŒéªŒè¯ JWT Tokenï¼Œå¿…é¡»ä¿®æ”¹é»˜è®¤å€¼

**ç”Ÿæˆæ–¹å¼**ï¼š

**æ–¹å¼ 1ï¼šä½¿ç”¨ OpenSSLï¼ˆæ¨èï¼‰**
```bash
openssl rand -hex 32
```

**æ–¹å¼ 2ï¼šä½¿ç”¨ Python**
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

**æ–¹å¼ 3ï¼šä½¿ç”¨åœ¨çº¿å·¥å…·**
- è®¿é—®ï¼šhttps://randomkeygen.com/
- é€‰æ‹© "CodeIgniter Encryption Keys"
- å¤åˆ¶ä¸€ä¸ª 32 ä½æˆ–æ›´é•¿çš„å¯†é’¥

**é…ç½®å€¼**ï¼š
```env
SECRET_KEY=ä½ ç”Ÿæˆçš„å¯†é’¥ï¼ˆè‡³å°‘32ä¸ªå­—ç¬¦ï¼‰
```

**ç¤ºä¾‹**ï¼š
```env
SECRET_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

âš ï¸ **é‡è¦**ï¼š
- ä¸è¦ä½¿ç”¨é»˜è®¤å€¼ `your-secret-key-change-in-production`
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºå¯†é’¥
- ä¸è¦å°†å¯†é’¥æäº¤åˆ° Git

---

### 3. AI API Keyï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰

#### é€‰é¡¹ Aï¼šä½¿ç”¨é€šä¹‰åƒé—®ï¼ˆæ¨èï¼Œä» rock-server è·å–ï¼‰

**ä½œç”¨**ï¼šç”¨äºé£Ÿç‰©å›¾åƒè¯†åˆ«

**è·å–æ–¹å¼**ï¼š

**æ–¹å¼ 1ï¼šä» rock-server é…ç½®æ–‡ä»¶è¯»å–**
```bash
# æŸ¥çœ‹ rock-server çš„é…ç½®
cat /Users/conalin/rock-server/config/.env.stage | grep DASHSCOPE_API_KEY
```

**æ–¹å¼ 2ï¼šæŸ¥çœ‹ç¯å¢ƒå˜é‡**
```bash
echo $DASHSCOPE_API_KEY
```

**æ–¹å¼ 3ï¼šæ‰‹åŠ¨æŸ¥çœ‹**
- æ‰“å¼€ `/Users/conalin/rock-server/config/.env.stage`
- æ‰¾åˆ° `DASHSCOPE_API_KEY=` è¿™ä¸€è¡Œ
- å¤åˆ¶ç­‰å·åé¢çš„å€¼

**é…ç½®å€¼**ï¼š
```env
DASHSCOPE_API_KEY=ä»rock-serverå¤åˆ¶çš„key
```

**ç¤ºä¾‹**ï¼š
```env
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### é€‰é¡¹ Bï¼šä½¿ç”¨ OpenAI

**ä½œç”¨**ï¼šç”¨äºé£Ÿç‰©å›¾åƒè¯†åˆ«ï¼ˆå¦‚æœä¸ç”¨é€šä¹‰åƒé—®ï¼‰

**è·å–æ–¹å¼**ï¼š
1. è®¿é—® https://platform.openai.com/api-keys
2. ç™»å½• OpenAI è´¦å·
3. åˆ›å»ºæ–°çš„ API Key
4. å¤åˆ¶ Key

**é…ç½®å€¼**ï¼š
```env
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

âš ï¸ **æ³¨æ„**ï¼š
- è‡³å°‘é…ç½®ä¸€ä¸ª AI API Keyï¼ˆOPENAI æˆ– DASHSCOPEï¼‰
- å¦‚æœä¸¤ä¸ªéƒ½é…ç½®ï¼Œç³»ç»Ÿä¼šä¼˜å…ˆä½¿ç”¨ DASHSCOPE_API_KEY

---

## âš™ï¸ å¯é€‰é…ç½®é¡¹è¯´æ˜

### AWS S3 å­˜å‚¨ï¼ˆå·²é…ç½®ï¼‰

**ä½œç”¨**ï¼šå­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„é£Ÿç‰©å›¾ç‰‡

**é…ç½®å€¼**ï¼ˆå·²é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ï¼‰ï¼š
```env
AWS_ACCESS_KEY_ID=AKIAW5WU5C4HN6FSSOFC
AWS_SECRET_ACCESS_KEY=UP61KnmqnaNSip0BBij/5HW7taNtyeb3ArupsDR
AWS_REGION=us-east-2
AWS_S3_BUCKET=diabeat-ai-images
S3_URL=https://diabeat-ai-images.s3.us-east-2.amazonaws.com
```

âœ… **å·²é…ç½®å®Œæˆï¼Œæ— éœ€ä¿®æ”¹**

---

### Firebase FCMï¼ˆå¯é€‰ï¼‰

**ä½œç”¨**ï¼šå‘é€æ¨é€é€šçŸ¥

**é…ç½®å€¼**ï¼š
```env
FIREBASE_CREDENTIALS_PATH=/path/to/diabeat-firebase-adminsdk.json
```

**è¯¦ç»†é…ç½®**ï¼šå‚è€ƒ `docs/FCM_SETUP.md`

---

## ğŸ“‹ å®Œæ•´é…ç½®ç¤ºä¾‹

### æœ€å°é…ç½®ï¼ˆå¿…éœ€é¡¹ï¼‰

```env
# æ•°æ®åº“
DATABASE_URL=postgresql://diabeat:diabeat123@localhost:5432/diabeat

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
SECRET_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6

# AI API Keyï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### å®Œæ•´é…ç½®ï¼ˆåŒ…å«å¯é€‰é¡¹ï¼‰

```env
# ============================================
# å¿…éœ€é…ç½®
# ============================================

DATABASE_URL=postgresql://diabeat:diabeat123@localhost:5432/diabeat
SECRET_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ============================================
# å¯é€‰é…ç½®
# ============================================

ENVIRONMENT=dev
HOST=localhost:8000

# AWS S3ï¼ˆå·²é…ç½®ï¼‰
AWS_ACCESS_KEY_ID=AKIAW5WU5C4HN6FSSOFC
AWS_SECRET_ACCESS_KEY=UP61KnmqnaNSip0BBij/5HW7taNtyeb3ArupsDR
AWS_REGION=us-east-2
AWS_S3_BUCKET=diabeat-ai-images
S3_URL=https://diabeat-ai-images.s3.us-east-2.amazonaws.com

# Firebase FCMï¼ˆå¯é€‰ï¼‰
FIREBASE_CREDENTIALS_PATH=/path/to/diabeat-firebase-adminsdk.json
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

é…ç½®å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ï¼š

- [ ] `DATABASE_URL` å·²é…ç½®ï¼ˆæ ¼å¼æ­£ç¡®ï¼‰
- [ ] `SECRET_KEY` å·²ä¿®æ”¹ï¼ˆä¸æ˜¯é»˜è®¤å€¼ï¼‰
- [ ] `DASHSCOPE_API_KEY` æˆ– `OPENAI_API_KEY` å·²é…ç½®ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰
- [ ] AWS S3 é…ç½®å·²ç¡®è®¤ï¼ˆå·²é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ï¼‰

---

## ğŸ§ª éªŒè¯é…ç½®

### æ–¹å¼ 1ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
cd diabeat-server
python3 -c "from app.config import settings; print(f'DATABASE_URL: {settings.DATABASE_URL[:30]}...'); print(f'SECRET_KEY: {\"å·²è®¾ç½®\" if settings.SECRET_KEY != \"your-secret-key-change-in-production\" else \"æœªä¿®æ”¹\"}'); print(f'DASHSCOPE_API_KEY: {\"å·²è®¾ç½®\" if settings.DASHSCOPE_API_KEY else \"æœªè®¾ç½®\"}')"
```

### æ–¹å¼ 2ï¼šå¯åŠ¨æœåŠ¡æµ‹è¯•

```bash
# å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload

# å¦‚æœå¯åŠ¨æˆåŠŸï¼Œè¯´æ˜é…ç½®æ­£ç¡®
# è®¿é—® http://localhost:8000/docs æŸ¥çœ‹ API æ–‡æ¡£
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·å– DASHSCOPE_API_KEYï¼Ÿ

**A**: ä» rock-server çš„é…ç½®æ–‡ä»¶è·å–ï¼š
```bash
cat /Users/conalin/rock-server/config/.env.stage | grep DASHSCOPE_API_KEY
```

### Q2: SECRET_KEY å¿…é¡»ä¿®æ”¹å—ï¼Ÿ

**A**: æ˜¯çš„ï¼Œå¿…é¡»ä¿®æ”¹ã€‚ä½¿ç”¨é»˜è®¤å€¼ä¸å®‰å…¨ã€‚

### Q3: æ•°æ®åº“è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯åŠ¨ï¼š`docker ps | grep postgres`
2. æ£€æŸ¥è¿æ¥å­—ç¬¦ä¸²æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“åæ˜¯å¦æ­£ç¡®

### Q4: å¯ä»¥åªé…ç½® OPENAI_API_KEY è€Œä¸é…ç½® DASHSCOPE_API_KEY å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œè‡³å°‘é…ç½®ä¸€ä¸ªå³å¯ã€‚

---

**æœ€åæ›´æ–°**ï¼š2025-11-06

