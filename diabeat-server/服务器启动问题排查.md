# 服务器启动问题排查

## ✅ 已完成的修复

1. **安装缺失依赖**
   - ✅ 已安装 `dashscope`
   - ✅ 已安装所有 `requirements.txt` 中的依赖

2. **创建缺失目录**
   - ✅ 已创建 `static` 目录
   - ✅ 已创建 `static/uploads` 目录

3. **模块导入测试**
   - ✅ 模块导入成功

4. **服务器进程**
   - ✅ 进程正在运行（PID: 13166）
   - ✅ 端口 8000 已被占用

---

## 🔍 当前状态

### 服务器进程
- **进程 ID**：13166
- **命令**：`python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000`
- **状态**：运行中

### 端口状态
- **端口**：8000
- **状态**：已被占用

---

## 🧪 测试访问

### 方法 1：浏览器访问

打开浏览器，访问：
- **API 文档**：http://localhost:8000/docs
- **健康检查**：http://localhost:8000/health
- **备用地址**：http://127.0.0.1:8000/docs

### 方法 2：命令行测试

```bash
# 健康检查
curl http://localhost:8000/health

# 或使用 IP 地址
curl http://127.0.0.1:8000/health
```

### 方法 3：检查服务器日志

如果服务器在后台运行，可能需要查看日志：

```bash
# 查看进程输出（如果有日志文件）
# 或者重新在前台运行查看错误信息
```

---

## 🐛 可能的问题

### 问题 1：服务器启动慢

**原因**：首次启动需要加载所有模块，可能需要几秒钟

**解决**：等待 10-15 秒后再次尝试访问

### 问题 2：防火墙阻止

**检查**：
```bash
# Mac 检查防火墙
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
```

### 问题 3：端口被其他程序占用

**检查**：
```bash
lsof -i:8000
```

**解决**：
```bash
# 停止占用端口的进程
kill $(lsof -ti:8000)

# 或使用其他端口
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

---

## 🔧 重新启动服务器（前台运行）

如果想查看详细的启动日志和错误信息：

```bash
cd diabeat-server

# 停止后台进程
kill $(lsof -ti:8000)

# 前台运行（可以看到所有输出）
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

这样可以看到任何错误信息。

---

## ✅ 验证步骤

1. **检查进程**
   ```bash
   ps aux | grep uvicorn
   ```

2. **检查端口**
   ```bash
   lsof -i:8000
   ```

3. **测试连接**
   ```bash
   curl http://localhost:8000/health
   ```

4. **浏览器访问**
   - 打开 http://localhost:8000/docs

---

## 📋 检查清单

- [x] 依赖已安装
- [x] static 目录已创建
- [x] 模块导入成功
- [x] 服务器进程正在运行
- [x] 端口 8000 已被占用
- [ ] 可以访问 http://localhost:8000/docs
- [ ] 健康检查返回 `{"status":"ok"}`

---

**建议**：如果浏览器无法访问，尝试在前台运行服务器查看详细错误信息。

