# 启动服务器指南

## ✅ 服务器已启动

服务器正在后台运行：

- **地址**：http://localhost:8000
- **API 文档**：http://localhost:8000/docs
- **健康检查**：http://localhost:8000/health

---

## 📋 启动信息

### 配置状态

- ✅ DATABASE_URL：已配置
- ✅ SECRET_KEY：已设置（已修改默认值）
- ✅ DASHSCOPE_API_KEY：已设置
- ✅ 端口 8000：可用

### 依赖状态

- ✅ FastAPI：已安装（0.110.0）
- ✅ Uvicorn：已安装（0.27.1）

---

## 🚀 服务器命令

### 启动服务器

```bash
cd diabeat-server
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**参数说明**：
- `--reload`：自动重载（开发模式）
- `--host 0.0.0.0`：监听所有网络接口（允许模拟器访问）
- `--port 8000`：端口号

### 停止服务器

按 `Ctrl+C` 停止服务器

### 后台运行

```bash
# 使用 nohup
nohup python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000 > server.log 2>&1 &

# 查看日志
tail -f server.log
```

---

## 🧪 验证服务器

### 1. 健康检查

```bash
curl http://localhost:8000/health
```

**预期响应**：
```json
{"status":"ok"}
```

### 2. API 文档

打开浏览器访问：http://localhost:8000/docs

### 3. 测试 API

```bash
# 测试用户注册
curl -X POST "http://localhost:8000/api/users/register" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "diabetes_type": "type1",
    "name": "Test User"
  }'
```

---

## ⚠️ 注意事项

### 1. 数据库（可选）

如果数据库未运行，某些功能可能不可用：
- 用户注册/登录
- 数据记录
- 历史查询

**启动数据库**（如果已安装 Docker）：
```bash
cd diabeat-server
docker-compose up -d db
```

### 2. 网络访问

- **本地访问**：http://localhost:8000
- **模拟器访问**：http://10.0.2.2:8000
- **局域网访问**：http://你的IP:8000

### 3. 防火墙

确保防火墙允许端口 8000 的访问。

---

## 📱 模拟器连接

Android 模拟器使用特殊地址访问本地服务器：

- **模拟器地址**：`http://10.0.2.2:8000`
- **已配置**：`diabeat-android/app/src/main/res/values/config.xml`

---

## 🐛 常见问题

### 问题 1：端口被占用

**错误**：`Address already in use`

**解决**：
```bash
# 查找占用端口的进程
lsof -ti:8000

# 杀死进程
kill -9 $(lsof -ti:8000)

# 或使用其他端口
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

### 问题 2：模块导入错误

**错误**：`ModuleNotFoundError`

**解决**：
```bash
# 安装依赖
pip3 install -r requirements.txt
```

### 问题 3：数据库连接失败

**错误**：`could not connect to server`

**解决**：
- 检查数据库是否运行
- 检查 DATABASE_URL 配置
- 如果不需要数据库，某些功能可能不可用

---

## ✅ 检查清单

- [x] 服务器已启动
- [x] 配置已设置
- [x] 依赖已安装
- [x] 端口 8000 可用
- [ ] 数据库已启动（可选）
- [ ] 健康检查通过
- [ ] API 文档可访问

---

**服务器状态**：✅ **运行中**

**下一步**：在 Android Studio 中运行应用

